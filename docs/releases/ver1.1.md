# Keyball ver1.1 リリースノート

## 概要
ver1.1 では振動ドライバ（DRV2605L）を導入し、スワイプ系の割り当てを見直しました。user キーマップを一括ビルドするスクリプトあわせて含まれます。軽微なバグも修正しました。

## Vial キーマップ移行の注意（最重要）
- ver1.1 を書き込む前に、かならず Vial 上でキーマップをエクスポートしてください。アップデート後は `KBC_RST`を一度実行し、Vial で設定を再インポートする必要があります。
- `KBC_RST` を挟まないと新しい設定領域が初期化されず、AML やハプティック関連の設定が正常に動作しない可能性があります。
- OLED で項目を調整した後は `KBC_SAVE` を押して保存してください。保存しない場合は再接続時に設定が失われます。

## 主な変更点
### AML / ハプティック
- DRV2605L（I2C 接続）による振動ドライバをサポートし、左右それぞれのモーターを制御できるようになりました。
- Auto Mouse Layer（AML）遷移/解除時に専用エフェクトを鳴らせるようになり、OLED の「AML haptic」ページからモード番号／有効/無効をリアルタイムで設定できます。
- スワイプ時の一次／二次エフェクト、レイヤーごとの左右エフェクトも OLED から設定可能になりました（SW_Hp / Ly_Hp ページ）。

### スワイプ / マクロ
- `SW_UTIL` を追加し、Esc→LANG2(PC動作の汎用的なキャンセル動作を想定しています) をタップで呼び出しつつ、上下左右にコピー/ペースト/Undo/Redo を割り当てました。
- `SW_VOL`（音量/再生）や `SW_WIN`（Windows Snap / mac Fn+Ctrl）など OS ごとに異なるショートカットを `tap_code16_os()` へ統一し、左右方向の挙動を調整しました。
- ブラウザスワイプではダブルタップでリロードできるようになり、`SW_EX1/EX2` や FLICK_* の方向割り当ても実装通りの値にそろえました。

### ビルド / ドキュメント
- `scripts/build_user_maps.sh` を追加し、`keyball{39,44,61}` × `user_{dual,left,right}` の 9 ターゲットを一括ビルドできるようにしました（`README.md` にも記載）。
- `docs/manual_setup.md` / `docs/docker_setup.md` を最新のコマンド・スクリプトに合わせて更新しました。

## 推奨アップデート手順
1. 旧バージョン（ver1.0）で Vial 設定をエクスポートする。
2. ver1.1 の `.uf2` を書き込む（必要に応じて `scripts/build_user_maps.sh` で最新ビルドを作成）。
3. 本体で `KBC_RST` → `KBC_SAVE` を実行し、新しい設定構造を初期化する。
4. Vial を開いて設定をインポート、または手動でキーマップを調整し、完了後に再度 `KBC_SAVE` を押す。
5. AML/スワイプ/ハプティックの動作を確認し、必要なら OLED 設定画面で値を微調整する。

## バグ修正
- RALT(KC_F*)によるmacでの動作を修正しました。
- RALT(KC_HOME/END/PGUP/PGDN)の動作を修正しました。
